!function(t){t.module("thebusao",["ionic","ngMap","ui.router","ngCordova"]).run(["$ionicPlatform","fixtureFactory",function(t,o){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),o.addConnectivityListeners()})}]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,o,e){t.state("map",{url:"/map",templateUrl:"templates/map/map.html",controller:"mapController as vm"}),o.otherwise("/map"),e.interceptors.push("authFactory")}]).constant("URL","https://thebusao.herokuapp.com/api"),function(){"use strict";function o(t,o,e){function n(n){return n.headers=n.headers||{},t.localStorage.getItem("data")&&n.url!=e+"/v1/token"&&(n.headers["x-access-token"]=t.localStorage.getItem("data")),n||o.when(n)}function i(t){return t||o.when(t)}function a(t){return o.reject(t)}return{request:n,response:i,responseError:a,requestError:a}}t.module("thebusao").factory("authFactory",o),o.$inject=["$window","$q","URL"]}(),function(){"use strict";function o(t,o,e,n,i,a,r){function c(){function n(t){return e.localStorage.setItem("data",t.data.token),!0}function i(t){return!1}return t.get(o+"/v1/token").then(n)["catch"](i)}function u(t,o){function e(t){var o=t?"<img src='img/"+t+".svg' class='svg-inject' />":'<div class="loader"></div';i.show({template:o,animate:"fade-in",showBackdrop:!0})}function n(){i.hide()}t?e(o):n()}function s(t){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(t?cordova.plugins.Keyboard.show():cordova.plugins.Keyboard.close())})}function l(){ionic.Platform.isWebView()&&(n.$on("$cordovaNetwork:online",function(t,o){i.hide()}),n.$on("$cordovaNetwork:offline",function(t,o){i.show({template:"Aguardando conexão com a internet..."})}))}return{getTokenValidRequest:c,getLoading:u,keyboard:s,addConnectivityListeners:l}}t.module("thebusao").factory("fixtureFactory",o),o.$inject=["$http","URL","$window","$rootScope","$ionicLoading","$ionicPlatform","$cordovaNetwork"]}(),function(){"use strict";function o(t,o,e){return function(){var n={timeout:1e4,enableHighAccuracy:!1},i=e.defer();return o.ready(function(){function o(t){i.resolve(t)}function e(t){i.reject(t)}t.getCurrentPosition(n).then(o,e)}),i.promise}}t.module("thebusao").factory("geolocationService",o),o.$inject=["$cordovaGeolocation","$ionicPlatform","$q"]}(),function(){"use strict";function o(t,o,e,n,i,a,r){function c(){t.getTokenValidRequest().then(function(t){s()})}function u(e){o.getVehicles(e).then(function(o){0==o.length?(h.alertPopup=i.alert({title:"Aviso!",template:"Não a ônibus disponível no momento",okType:"button-calm"}),h.bus=""):(h.busAll=o,h.search=o[0].Denomicao,h.large=!1,p(o)),t.getLoading(!1)})}function s(e){o.getLines(e).then(function(o){h.linesAll=o,t.getLoading(!1)})}function l(o){t.keyboard(!1),n(function(){t.getLoading(!0),u(o.CodigoLinha)},500)}function d(t,o){h.bus=o,h.map.showInfoWindow("bal",h.bus.CodigoVeiculo)}function f(){t.getLoading(!0,"gps"),r().then(function(o){h.userPosition=[],h.userPosition[0]=o.coords.latitude,h.userPosition[1]=o.coords.longitude,h.zoom=11,h.map.setCenter(new google.maps.LatLng(o.coords.latitude,o.coords.longitude)),t.getLoading(!1)})["catch"](function(o){t.getLoading(!1),h.alertPopup=i.alert({title:"Aviso!",template:"Para obter sua posição ative seu GPS eclique novamente no icone de localização",okType:"button-calm"})})}function g(){h.search="",h.large=!0}function p(t){1===t.length&&(h.map.setCenter(new google.maps.LatLng(t[0].Lat,t[0].Long)),h.map.setZoom(15))}var h=this;h.linesAll=[],h.busAll=[],h.p=[-5.0958287,-42.7843285],h.zoom=10,h.large=!0,h.setBusMap=l,h.showDetail=d,h.getCenterLocation=f,h.clearSearch=g,t.getLoading(!0),a.getMap().then(function(t){h.map=t,c()})}t.module("thebusao").controller("mapController",o),o.$inject=["fixtureFactory","mapFactory","$scope","$timeout","$ionicPopup","NgMap","geolocationService"]}(),function(){"use strict";function o(t,o,e,n){function i(n){function i(t){return t.data.result}function a(t){null!=t.data&&"Token expirado"===t.data.err&&e.getTokenValidRequest().then(function(t){r.getLines()})}var r=this,c=void 0!=n?n:"";return o.get(t+"/v1/lines/"+c).then(i)["catch"](a)}function a(n){function i(t){return t.data.result}function a(t){null!=t.data&&"Token expirado"===t.data.err&&e.getTokenValidRequest().then(function(t){r.getVehicles()})}var r=this,c=void 0!=n?n:"";return o.get(t+"/v1/vehicles/"+c).then(i)["catch"](a)}return{getLines:i,getVehicles:a}}t.module("thebusao").factory("mapFactory",o),o.$inject=["URL","$http","fixtureFactory","$timeout"]}()}(angular);